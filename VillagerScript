using System.Collections.Generic;
using UnityEngine;

public class Villager
{
    public string Name { get; }
    public VillagerClass Class { get; }
    public int Level { get; private set; } = 1;
    public int Experience { get; private set; }
    public Dictionary<SkillType, int> Skills { get; }
    public Dictionary<AttributeType, int> Attributes { get; }
    public List<AbilityType> Abilities { get; }
    public List<TraitType> Traits { get; }

    private const int ExpToLevelUp = 100;

    public Villager(string name, VillagerClass villagerClass)
    {
        Name = name;
        Class = villagerClass;
        Attributes = VillagerAttributeManager.GenerateAndAssignAttributes(villagerClass);
        Skills = VillagerSkillManager.InitializeSkills(Attributes);
        Abilities = new List<AbilityType>();
        Traits = new List<TraitType>();
    }

    public void GainExperience(int amount)
    {
        Experience += amount;
        while (Experience >= ExpToLevelUp)
        {
            Experience -= ExpToLevelUp;
            LevelUp();
        }
    }

    private void LevelUp()
    {
        Level++;
        VillagerAttributeManager.UpgradeAttributes(Attributes);
        VillagerSkillManager.UpdateSkills(Skills, Attributes);

        if (Level % 4 == 0)
        {
            VillagerTraitManager.UnlockTrait(Traits, Class);
        }
        else
        {
            VillagerAbilityManager.UnlockAbility(Abilities, Class);
        }

        Debug.Log($"{Name} has leveled up to level {Level}!");
    }

    public void DisplayInfo()
    {
        Debug.Log($"Villager: {Name}, Class: {Class}, Level: {Level}, EXP: {Experience}");
        foreach (var attribute in Attributes)
            Debug.Log($"{attribute.Key}: {attribute.Value}");
        foreach (var skill in Skills)
            Debug.Log($"{skill.Key}: {skill.Value}");
        foreach (var ability in Abilities)
            Debug.Log(ability);
        foreach (var trait in Traits)
            Debug.Log(trait);
    }
}